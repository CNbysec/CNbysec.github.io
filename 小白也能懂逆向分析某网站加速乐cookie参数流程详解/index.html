<!DOCTYPE html>
<html lang="zh-CN">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>小白也能懂逆向分析某网站加速乐Cookie参数流程详解 - bysec</title><meta name="Description" content="bysec个人博客"><meta property="og:url" content="http://localhost:1313/%E5%B0%8F%E7%99%BD%E4%B9%9F%E8%83%BD%E6%87%82%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E6%9F%90%E7%BD%91%E7%AB%99%E5%8A%A0%E9%80%9F%E4%B9%90cookie%E5%8F%82%E6%95%B0%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/">
  <meta property="og:site_name" content="bysec">
  <meta property="og:title" content="小白也能懂逆向分析某网站加速乐Cookie参数流程详解">
  <meta property="og:description" content="bysec个人博客">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-10-06T20:42:37+08:00">
    <meta property="article:modified_time" content="2024-10-06T20:42:37+08:00">
    <meta property="article:tag" content="加速乐">
    <meta property="og:image" content="http://localhost:1313/logo.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/logo.png">
  <meta name="twitter:title" content="小白也能懂逆向分析某网站加速乐Cookie参数流程详解">
  <meta name="twitter:description" content="bysec个人博客">
<meta name="application-name" content="bysec">
<meta name="apple-mobile-web-app-title" content="bysec">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="https://q.qlogo.cn/headimg_dl?dst_uin=1726946232&amp;spec=640"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="http://localhost:1313/%E5%B0%8F%E7%99%BD%E4%B9%9F%E8%83%BD%E6%87%82%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E6%9F%90%E7%BD%91%E7%AB%99%E5%8A%A0%E9%80%9F%E4%B9%90cookie%E5%8F%82%E6%95%B0%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/" /><link rel="prev" href="http://localhost:1313/%E5%B8%B8%E7%94%A8%E7%9A%8438%E7%A7%8D%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E6%B1%87%E6%80%BB/" /><link rel="next" href="http://localhost:1313/%E5%B7%A5%E5%85%B7/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "小白也能懂逆向分析某网站加速乐Cookie参数流程详解",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/localhost:1313\/%E5%B0%8F%E7%99%BD%E4%B9%9F%E8%83%BD%E6%87%82%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E6%9F%90%E7%BD%91%E7%AB%99%E5%8A%A0%E9%80%9F%E4%B9%90cookie%E5%8F%82%E6%95%B0%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3\/"
        },"genre": "posts","keywords": "加速乐","wordcount":  3789 ,
        "url": "http:\/\/localhost:1313\/%E5%B0%8F%E7%99%BD%E4%B9%9F%E8%83%BD%E6%87%82%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E6%9F%90%E7%BD%91%E7%AB%99%E5%8A%A0%E9%80%9F%E4%B9%90cookie%E5%8F%82%E6%95%B0%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3\/","datePublished": "2024-10-06T20:42:37+08:00","dateModified": "2024-10-06T20:42:37+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "bysec"
            },"description": ""
    }
    </script></head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark');}
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="bysec">bysec</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"><i class='fa-fw fas fa-home'></i> 首页 </a><a class="menu-item" href="/posts/"><i class='fa-fw fas fa-archive'></i> 归档 </a><a class="menu-item" href="/categories/"><i class='fa-fw fas fa-folder-open'></i> 分类 </a><a class="menu-item" href="/tags/"><i class='fa-fw fas fa-tags'></i> 标签 </a><a class="menu-item" href="/link/"><i class='fa-fw fas fa-link'></i> 友链 </a><a class="menu-item" href="/about/"><i class='fa-fw fas fa-comment-dots'></i> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="#" onclick="return false;" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" onclick="return false;" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="#" onclick="return false;" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="bysec">bysec</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="#" onclick="return false;" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="#" onclick="return false;" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="#" onclick="return false;" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/" title=""><i class='fa-fw fas fa-home'></i>首页</a><a class="menu-item" href="/posts/" title=""><i class='fa-fw fas fa-archive'></i>归档</a><a class="menu-item" href="/categories/" title=""><i class='fa-fw fas fa-folder-open'></i>分类</a><a class="menu-item" href="/tags/" title=""><i class='fa-fw fas fa-tags'></i>标签</a><a class="menu-item" href="/link/" title=""><i class='fa-fw fas fa-link'></i>友链</a><a class="menu-item" href="/about/" title=""><i class='fa-fw fas fa-comment-dots'></i>关于</a><a href="#" onclick="return false;" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">目录</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#声明">声明</a></li>
    <li><a href="#什么是加速乐">什么是加速乐？</a></li>
    <li><a href="#今日网站">今日网站</a></li>
    <li><a href="#流程分析-浏览器">流程分析-浏览器</a>
      <ul>
        <li><a href="#第一次请求">第一次请求</a></li>
        <li><a href="#第二次请求">第二次请求</a></li>
        <li><a href="#第三次请求">第三次请求</a></li>
      </ul>
    </li>
    <li><a href="#流程分析-抓包工具">流程分析-抓包工具</a>
      <ul>
        <li><a href="#第一次请求-1">第一次请求</a></li>
        <li><a href="#第二次请求-1">第二次请求</a></li>
        <li><a href="#第三次请求-1">第三次请求</a></li>
      </ul>
    </li>
    <li><a href="#逆向分析">逆向分析</a>
      <ul>
        <li><a href="#获取第一个__jsl_clearance_s">获取第一个<code>__jsl_clearance_s</code></a></li>
        <li><a href="#获取第二个__jsl_clearance_s">获取第二个<code>__jsl_clearance_s</code></a></li>
      </ul>
    </li>
    <li><a href="#其它调试方式">其它调试方式</a>
      <ul>
        <li><a href="#hook-cookie值使用油猴断一下set-cookie位置"><code>Hook Cookie</code>值：使用油猴断一下set cookie位置</a></li>
        <li><a href="#文件替换利用-fiddler-的自动响应">文件替换：利用 Fiddler 的<code>自动响应</code>。</a></li>
        <li><a href="#文件替换利用-chrome-的文件替换">文件替换：利用 Chrome 的文件替换</a></li>
      </ul>
    </li>
    <li><a href="#结果验证">结果验证</a></li>
    <li><a href="#小结">小结</a></li>
    <li><a href="#最后">最后</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle", "normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">小白也能懂逆向分析某网站加速乐Cookie参数流程详解</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><i class="author fas fa-user-circle fa-fw"></i><a href="https://www.bysec.cn/" title="Author" target="_blank" rel="noopener noreferrer author" class="author">bysec</a>
                </span>&nbsp;<span class="post-category">收录于 </span>&nbsp;<span class="post-category">类别 <a href="/categories/%E9%80%86%E5%90%91/"><i class="far fa-folder fa-fw"></i>逆向</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2024-10-06">2024-10-06</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2024-10-06">2024-10-06</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 3789 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 8 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#前言">前言</a></li>
    <li><a href="#声明">声明</a></li>
    <li><a href="#什么是加速乐">什么是加速乐？</a></li>
    <li><a href="#今日网站">今日网站</a></li>
    <li><a href="#流程分析-浏览器">流程分析-浏览器</a>
      <ul>
        <li><a href="#第一次请求">第一次请求</a></li>
        <li><a href="#第二次请求">第二次请求</a></li>
        <li><a href="#第三次请求">第三次请求</a></li>
      </ul>
    </li>
    <li><a href="#流程分析-抓包工具">流程分析-抓包工具</a>
      <ul>
        <li><a href="#第一次请求-1">第一次请求</a></li>
        <li><a href="#第二次请求-1">第二次请求</a></li>
        <li><a href="#第三次请求-1">第三次请求</a></li>
      </ul>
    </li>
    <li><a href="#逆向分析">逆向分析</a>
      <ul>
        <li><a href="#获取第一个__jsl_clearance_s">获取第一个<code>__jsl_clearance_s</code></a></li>
        <li><a href="#获取第二个__jsl_clearance_s">获取第二个<code>__jsl_clearance_s</code></a></li>
      </ul>
    </li>
    <li><a href="#其它调试方式">其它调试方式</a>
      <ul>
        <li><a href="#hook-cookie值使用油猴断一下set-cookie位置"><code>Hook Cookie</code>值：使用油猴断一下set cookie位置</a></li>
        <li><a href="#文件替换利用-fiddler-的自动响应">文件替换：利用 Fiddler 的<code>自动响应</code>。</a></li>
        <li><a href="#文件替换利用-chrome-的文件替换">文件替换：利用 Chrome 的文件替换</a></li>
      </ul>
    </li>
    <li><a href="#结果验证">结果验证</a></li>
    <li><a href="#小结">小结</a></li>
    <li><a href="#最后">最后</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p><em>转载自： <a href="https://juejin.cn/post/7386485874300977178" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/7386485874300977178</a></em></p>
</blockquote>
<h2 id="前言" class="headerLink">
    <a href="#%e5%89%8d%e8%a8%80" class="header-mark"></a>前言</h2><p>加速乐作为一种常见的反爬虫技术，在网络上已有大量详尽深入的教程可供参考。然而，对于那些初次接触的人来说，直接面对它可能仍会感到困惑。</p>
<h2 id="声明" class="headerLink">
    <a href="#%e5%a3%b0%e6%98%8e" class="header-mark"></a>声明</h2><blockquote>
<p>本文仅用于学习交流，学习探讨逆向知识，欢迎私信共享学习心得。如有侵权，联系博主删除。请勿商用，否则后果自负。</p>
</blockquote>
<h2 id="什么是加速乐" class="headerLink">
    <a href="#%e4%bb%80%e4%b9%88%e6%98%af%e5%8a%a0%e9%80%9f%e4%b9%90" class="header-mark"></a>什么是加速乐？</h2><p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD000010CdJ93CHwXA.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD000010CdJ93CHwXA.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD000010CdJ93CHwXA.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD000010CdJ93CHwXA.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD000010CdJ93CHwXA.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD000010CdJ93CHwXA.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD000010CdJ93CHwXA.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD000010CdJ93CHwXA.jpg">
    </a></p>
<p>加速乐采用了一系列的高级反爬虫技术，包括OB混淆、动态加密算法和多层Cookie获取，以确保整体校验的严密性。关键校验字段位于Cookie中的<code>__jsl_clearance_s</code>。其<strong>验证过程通常涉及三次关键的请求</strong>：</p>
<ol>
<li>
<p><strong>首次请求</strong>：当用户首次尝试访问目标网站时，服务器会返回一个特殊的521状态码，其响应数据通过AAEncode技术进行混淆处理，以初步筛选访问者。</p>
</li>
<li>
<p><strong>二次请求</strong>：紧接着的第二次请求中，如果服务器继续检测到可疑行为，它会再次返回521状态码，但这次响应数据将采用更为复杂的OB混淆，进一步验证访问者的身份。</p>
</li>
<li>
<p><strong>三次请求</strong>：只有在前两次请求成功通过验证后，第三次请求才能成功访问网站，此时服务器将返回正常的状态码200，并提供用户所需的内容。</p>
</li>
</ol>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00001spKf70Onvsc.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00001spKf70Onvsc.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00001spKf70Onvsc.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00001spKf70Onvsc.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00001spKf70Onvsc.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00001spKf70Onvsc.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00001spKf70Onvsc.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00001spKf70Onvsc.jpg">
    </a></p>
<p>通过这一连串精心设计的步骤，加速乐确保了只有合法的访问者能够顺利获取网站数据，从而有效抵御恶意爬虫的侵扰，我们要做的就是模拟这些操作，获取想要的数据。</p>
<h2 id="今日网站" class="headerLink">
    <a href="#%e4%bb%8a%e6%97%a5%e7%bd%91%e7%ab%99" class="header-mark"></a>今日网站</h2><p>目标URL: <code>aHR0cHM6Ly93d3cuY252ZC5vcmcuY24vZmxhdy90eXBlbGlzdD90eXBlSWQ9Mjc=</code></p>
<h2 id="流程分析-浏览器" class="headerLink">
    <a href="#%e6%b5%81%e7%a8%8b%e5%88%86%e6%9e%90-%e6%b5%8f%e8%a7%88%e5%99%a8" class="header-mark"></a>流程分析-浏览器</h2><p>按照常规做法，我们首先进行网络抓包分析。</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00004JfmID1VsZLD.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00004JfmID1VsZLD.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00004JfmID1VsZLD.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00004JfmID1VsZLD.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00004JfmID1VsZLD.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00004JfmID1VsZLD.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00004JfmID1VsZLD.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00004JfmID1VsZLD.jpg">
    </a></p>
<h3 id="第一次请求" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%80%e6%ac%a1%e8%af%b7%e6%b1%82" class="header-mark"></a>第一次请求</h3><ul>
<li><code>发送</code>：未携带 Cookie</li>
<li><code>响应</code>：状态码<code>521</code>，Cookie 中的<code>__jsluid_s</code>值和<code>js</code>代码</li>
</ul>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00000K7qZU3ItDc3.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00000K7qZU3ItDc3.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00000K7qZU3ItDc3.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00000K7qZU3ItDc3.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00000K7qZU3ItDc3.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00000K7qZU3ItDc3.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00000K7qZU3ItDc3.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00000K7qZU3ItDc3.jpg">
    </a></p>
<h3 id="第二次请求" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%8c%e6%ac%a1%e8%af%b7%e6%b1%82" class="header-mark"></a>第二次请求</h3><ul>
<li><code>发送</code>：Cookie 携带<code>__jsluid_s</code>和<code>__jsl_clearance_s</code>值</li>
<li><code>响应</code>：状态码<code>521</code>，新的<code>js</code>代码</li>
</ul>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00002oaIvJ2FWXrj.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00002oaIvJ2FWXrj.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00002oaIvJ2FWXrj.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00002oaIvJ2FWXrj.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00002oaIvJ2FWXrj.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00002oaIvJ2FWXrj.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00002oaIvJ2FWXrj.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00002oaIvJ2FWXrj.jpg">
    </a></p>
<h3 id="第三次请求" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%89%e6%ac%a1%e8%af%b7%e6%b1%82" class="header-mark"></a>第三次请求</h3><ul>
<li><code>发送</code>：Cookie 携带原始<code>__jsluid_s</code>值，新的<code>__jsl_clearance_s</code>值</li>
<li><code>响应</code>：状态码<code>200</code>，正文内容</li>
</ul>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00003CsbsE3mrA5a.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00003CsbsE3mrA5a.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00003CsbsE3mrA5a.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00003CsbsE3mrA5a.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00003CsbsE3mrA5a.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00003CsbsE3mrA5a.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00003CsbsE3mrA5a.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00003CsbsE3mrA5a.jpg">
    </a></p>
<blockquote>
<p>观察结果揭示了对同一页面共发起了三次<code>HTTP</code>请求：前两次请求均遭遇了<code>521</code>状态码的响应，而最后一次请求成功收到了<code>200</code>状态码。这种模式正是加速乐反爬虫机制的显著特征。</p>
</blockquote>
<h2 id="流程分析-抓包工具" class="headerLink">
    <a href="#%e6%b5%81%e7%a8%8b%e5%88%86%e6%9e%90-%e6%8a%93%e5%8c%85%e5%b7%a5%e5%85%b7" class="header-mark"></a>流程分析-抓包工具</h2><p>浏览器上我们没能看到具体的响应，我们借助抓包工具试试，这里使用的<code>Fiddler</code>。</p>
<h3 id="第一次请求-1" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%80%e6%ac%a1%e8%af%b7%e6%b1%82-1" class="header-mark"></a>第一次请求</h3><p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00000bzZ1h0xViso.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00000bzZ1h0xViso.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00000bzZ1h0xViso.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00000bzZ1h0xViso.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00000bzZ1h0xViso.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00000bzZ1h0xViso.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00000bzZ1h0xViso.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00000bzZ1h0xViso.jpg">
    </a></p>
<h3 id="第二次请求-1" class="headerLink">
    <a href="#%e7%ac%ac%e4%ba%8c%e6%ac%a1%e8%af%b7%e6%b1%82-1" class="header-mark"></a>第二次请求</h3><p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00001MlfbN033sPr.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00001MlfbN033sPr.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00001MlfbN033sPr.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00001MlfbN033sPr.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00001MlfbN033sPr.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00001MlfbN033sPr.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00001MlfbN033sPr.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00001MlfbN033sPr.jpg">
    </a></p>
<h3 id="第三次请求-1" class="headerLink">
    <a href="#%e7%ac%ac%e4%b8%89%e6%ac%a1%e8%af%b7%e6%b1%82-1" class="header-mark"></a>第三次请求</h3><p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00000fEc7o2dk3Gg.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00000fEc7o2dk3Gg.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00000fEc7o2dk3Gg.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00000fEc7o2dk3Gg.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00000fEc7o2dk3Gg.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00000fEc7o2dk3Gg.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00000fEc7o2dk3Gg.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00000fEc7o2dk3Gg.jpg">
    </a></p>
<blockquote>
<p>同样，看到了三次请求的过程，并且向我们展示了具体的响应。</p>
</blockquote>
<h2 id="逆向分析" class="headerLink">
    <a href="#%e9%80%86%e5%90%91%e5%88%86%e6%9e%90" class="header-mark"></a>逆向分析</h2><h3 id="获取第一个__jsl_clearance_s" class="headerLink">
    <a href="#%e8%8e%b7%e5%8f%96%e7%ac%ac%e4%b8%80%e4%b8%aa__jsl_clearance_s" class="header-mark"></a>获取第一个<code>__jsl_clearance_s</code></h3><p>通过<code>Fiddler</code>或使用<code>python</code>模拟请求，得到下面这样一段JS代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">+!+</span><span class="p">[]</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="mi">4</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">-~</span><span class="kc">false</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">7</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">4</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">6</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="mi">2</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(([</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">0</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">-~</span><span class="mi">1</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="mi">2</span><span class="o">^</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="o">+</span><span class="kc">true</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">-~</span><span class="p">{}</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">~~</span><span class="s1">&#39;&#39;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">~~</span><span class="kc">false</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">-~</span><span class="mi">1</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">-~</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">-~</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="o">+</span><span class="kc">false</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="o">~~</span><span class="p">{}</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">);</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="o">=</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="o">+</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>复制到浏览器执行下来看看:</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD000025j1lt05AHCW.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD000025j1lt05AHCW.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD000025j1lt05AHCW.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD000025j1lt05AHCW.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD000025j1lt05AHCW.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD000025j1lt05AHCW.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD000025j1lt05AHCW.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD000025j1lt05AHCW.jpg">
    </a></p>
<p>得到了<code>__jsl_clearance_s=1719472445.236|-1|Lwj3uTFn1jj0Et0gI2JgiKm6Nf4%3D; Max-age=3600; Path=/; SameSite=None; Secure</code>。</p>
<p>而<code>__jsl_clearance_s</code>正是第二次请求需要带上的Cookie之一。</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00001H0vDS2nqE80.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00001H0vDS2nqE80.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00001H0vDS2nqE80.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00001H0vDS2nqE80.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00001H0vDS2nqE80.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00001H0vDS2nqE80.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00001H0vDS2nqE80.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00001H0vDS2nqE80.jpg">
    </a></p>
<blockquote>
<p>真的老登。为了使代码难以阅读和分析，还进行了<code>AAEncode</code>加密混淆。</p>
</blockquote>
<h3 id="获取第二个__jsl_clearance_s" class="headerLink">
    <a href="#%e8%8e%b7%e5%8f%96%e7%ac%ac%e4%ba%8c%e4%b8%aa__jsl_clearance_s" class="header-mark"></a>获取第二个<code>__jsl_clearance_s</code></h3><p>使用第一个请求后得到的 Cookies 继续发起第二段请求得到新的 JS 代码：</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00000Y8Qgg2tnsDM.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00000Y8Qgg2tnsDM.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00000Y8Qgg2tnsDM.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00000Y8Qgg2tnsDM.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00000Y8Qgg2tnsDM.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00000Y8Qgg2tnsDM.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00000Y8Qgg2tnsDM.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00000Y8Qgg2tnsDM.jpg">
    </a></p>
<p>代码被压缩了，不是很好看，使用在线 JS 美化（<code>https://spidertools.cn/#/formatJS</code>）后：</p>
<blockquote>
<p>其中有明显的特征，我们能判断出这是一个<code>OB混淆</code>加密：</p>
<ol>
<li>一般由一个大数组或者含有大数组的函数、一个自执行函数、解密函数和加密后的函数四部分组成；</li>
<li>函数名和变量名通常以<code>_0x</code>或者<code>0x</code>开头，后接<code>1~6</code>位数字或字母组合；</li>
<li>自执行函数，进行移位操作，有明显的<code>push、shift</code>关键字；</li>
</ol>
</blockquote>
<p>使用（<code>decode_obfuscator</code>）反混淆工具还原代码后，整体的结构就清晰了很多。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">hash</span><span class="p">(</span><span class="nx">_0x9060ec</span><span class="p">){</span><span class="kd">function</span> <span class="nx">_0x4f2105</span><span class="p">(</span><span class="nx">_0x548e11</span><span class="p">,</span><span class="nx">_0xd6f7ee</span><span class="p">){</span><span class="k">return</span><span class="p">(</span><span class="nx">_0x548e11</span><span class="o">&amp;</span><span class="mi">2147483647</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nx">_0xd6f7ee</span><span class="o">&amp;</span><span class="mi">2147483647</span><span class="p">)</span><span class="o">^</span><span class="nx">_0x548e11</span><span class="o">&amp;</span><span class="mi">2147483648</span><span class="o">^</span><span class="nx">_0xd6f7ee</span><span class="o">&amp;</span><span class="mi">2147483648</span><span class="p">}</span><span class="kd">function</span> <span class="nx">_0x47bf39</span><span class="p">(</span><span class="nx">_0x1f2dca</span><span class="p">){</span><span class="kd">var</span> <span class="nx">_0x3be7c6</span><span class="o">=</span><span class="s2">&#34;0123456789abcdef&#34;</span><span class="p">;</span><span class="kd">var</span> <span class="nx">_0x403cd2</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">_0x49d9bb</span><span class="o">=</span><span class="mi">7</span><span class="p">;</span><span class="nx">_0x49d9bb</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="nx">_0x49d9bb</span><span class="o">--</span><span class="p">){</span><span class="nx">_0x403cd2</span><span class="o">+=</span><span class="nx">_0x3be7c6</span><span class="p">[</span><span class="s2">&#34;charAt&#34;</span><span class="p">](</span><span class="nx">_0x1f2dca</span><span class="o">&gt;&gt;</span><span class="nx">_0x49d9bb</span><span class="o">*</span><span class="mi">4</span><span class="o">&amp;</span><span class="mi">15</span><span class="p">)}</span><span class="k">return</span> <span class="nx">_0x403cd2</span><span class="p">}</span><span class="kd">function</span> <span class="nx">_0x374691</span><span class="p">(</span><span class="nx">_0x3431f4</span><span class="p">){</span><span class="kd">var</span> <span class="nx">_0x2277fb</span><span class="o">=</span><span class="p">(</span><span class="nx">_0x3431f4</span><span class="p">[</span><span class="s2">&#34;length&#34;</span><span class="p">]</span><span class="o">+</span><span class="mi">8</span><span class="o">&gt;&gt;</span><span class="mi">6</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nx">_0x4c0e2f</span><span class="o">=</span><span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">_0x2277fb</span><span class="o">*</span><span class="mi">16</span><span class="p">);</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">_0x30af97</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">_0x30af97</span><span class="o">&lt;</span><span class="nx">_0x2277fb</span><span class="o">*</span><span class="mi">16</span><span class="p">;</span><span class="nx">_0x30af97</span><span class="o">++</span><span class="p">){</span><span class="nx">_0x4c0e2f</span><span class="p">[</span><span class="nx">_0x30af97</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">}</span><span class="k">for</span><span class="p">(</span><span class="nx">_0x30af97</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">_0x30af97</span><span class="o">&lt;</span><span class="nx">_0x3431f4</span><span class="p">[</span><span class="s2">&#34;length&#34;</span><span class="p">];</span><span class="nx">_0x30af97</span><span class="o">++</span><span class="p">){</span><span class="nx">_0x4c0e2f</span><span class="p">[</span><span class="nx">_0x30af97</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">]</span><span class="o">|=</span><span class="nx">_0x3431f4</span><span class="p">[</span><span class="s2">&#34;charCodeAt&#34;</span><span class="p">](</span><span class="nx">_0x30af97</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="o">-</span><span class="p">(</span><span class="nx">_0x30af97</span><span class="o">&amp;</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">}</span><span class="nx">_0x4c0e2f</span><span class="p">[</span><span class="nx">_0x30af97</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">]</span><span class="o">|=</span><span class="mi">128</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="o">-</span><span class="p">(</span><span class="nx">_0x30af97</span><span class="o">&amp;</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="p">;</span><span class="nx">_0x4c0e2f</span><span class="p">[</span><span class="nx">_0x2277fb</span><span class="o">*</span><span class="mi">16</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nx">_0x3431f4</span><span class="p">[</span><span class="s2">&#34;length&#34;</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span><span class="p">;</span><span class="k">return</span> <span class="nx">_0x4c0e2f</span><span class="p">}</span><span class="kd">function</span> <span class="nx">_0x4b3f91</span><span class="p">(</span><span class="nx">_0x5b9026</span><span class="p">,</span><span class="nx">_0x3ad37a</span><span class="p">){</span><span class="k">return</span> <span class="nx">_0x5b9026</span><span class="o">&lt;&lt;</span><span class="nx">_0x3ad37a</span><span class="o">|</span><span class="nx">_0x5b9026</span><span class="o">&gt;&gt;&gt;</span><span class="mi">32</span><span class="o">-</span><span class="nx">_0x3ad37a</span><span class="p">}</span><span class="kd">function</span> <span class="nx">_0x1a51fe</span><span class="p">(</span><span class="nx">_0x146005</span><span class="p">,</span><span class="nx">_0x208eab</span><span class="p">,</span><span class="nx">_0x37ebce</span><span class="p">,</span><span class="nx">_0x2300eb</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">_0x146005</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">){</span><span class="k">return</span> <span class="nx">_0x208eab</span><span class="o">&amp;</span><span class="nx">_0x37ebce</span><span class="o">|~</span><span class="nx">_0x208eab</span><span class="o">&amp;</span><span class="nx">_0x2300eb</span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="nx">_0x146005</span><span class="o">&lt;</span><span class="mi">40</span><span class="p">){</span><span class="k">return</span> <span class="nx">_0x208eab</span><span class="o">^</span><span class="nx">_0x37ebce</span><span class="o">^</span><span class="nx">_0x2300eb</span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="nx">_0x146005</span><span class="o">&lt;</span><span class="mi">60</span><span class="p">){</span><span class="k">return</span> <span class="nx">_0x208eab</span><span class="o">&amp;</span><span class="nx">_0x37ebce</span><span class="o">|</span><span class="nx">_0x208eab</span><span class="o">&amp;</span><span class="nx">_0x2300eb</span><span class="o">|</span><span class="nx">_0x37ebce</span><span class="o">&amp;</span><span class="nx">_0x2300eb</span><span class="p">}</span><span class="k">return</span> <span class="nx">_0x208eab</span><span class="o">^</span><span class="nx">_0x37ebce</span><span class="o">^</span><span class="nx">_0x2300eb</span><span class="p">}</span><span class="kd">function</span> <span class="nx">_0x5657a6</span><span class="p">(</span><span class="nx">_0x2b076a</span><span class="p">){</span><span class="k">return</span> <span class="nx">_0x2b076a</span><span class="o">&lt;</span><span class="mi">20</span><span class="o">?</span><span class="mi">1518500249</span><span class="o">:</span><span class="nx">_0x2b076a</span><span class="o">&lt;</span><span class="mi">40</span><span class="o">?</span><span class="mi">1859775393</span><span class="o">:</span><span class="nx">_0x2b076a</span><span class="o">&lt;</span><span class="mi">60</span><span class="o">?-</span><span class="mi">1894007588</span><span class="o">:-</span><span class="mi">899497514</span><span class="p">}</span><span class="kd">var</span> <span class="nx">_0x433d77</span><span class="o">=</span><span class="nx">_0x374691</span><span class="p">(</span><span class="nx">_0x9060ec</span><span class="p">);</span><span class="kd">var</span> <span class="nx">_0x1520f3</span><span class="o">=</span><span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span><span class="kd">var</span> <span class="nx">_0x236556</span><span class="o">=</span><span class="mi">1732584193</span><span class="p">;</span><span class="kd">var</span> <span class="nx">_0x126bca</span><span class="o">=-</span><span class="mi">271733879</span><span class="p">;</span><span class="kd">var</span> <span class="nx">_0x3ca08c</span><span class="o">=-</span><span class="mi">1732584194</span><span class="p">;</span><span class="kd">var</span> <span class="nx">_0x1ad745</span><span class="o">=</span><span class="mi">271733878</span><span class="p">;</span><span class="kd">var</span> <span class="nx">_0x3d4ab1</span><span class="o">=-</span><span class="mi">1009589776</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">_0x52e4f0</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">_0x52e4f0</span><span class="o">&lt;</span><span class="nx">_0x433d77</span><span class="p">[</span><span class="s2">&#34;length&#34;</span><span class="p">];</span><span class="nx">_0x52e4f0</span><span class="o">+=</span><span class="mi">16</span><span class="p">){</span><span class="kd">var</span> <span class="nx">_0x5d6482</span><span class="o">=</span><span class="nx">_0x236556</span><span class="p">;</span><span class="kd">var</span> <span class="nx">_0x1bdba3</span><span class="o">=</span><span class="nx">_0x126bca</span><span class="p">;</span><span class="kd">var</span> <span class="nx">_0x256655</span><span class="o">=</span><span class="nx">_0x3ca08c</span><span class="p">;</span><span class="kd">var</span> <span class="nx">_0xaf9465</span><span class="o">=</span><span class="nx">_0x1ad745</span><span class="p">;</span><span class="kd">var</span> <span class="nx">_0x35abf5</span><span class="o">=</span><span class="nx">_0x3d4ab1</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">_0x57665f</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">_0x57665f</span><span class="o">&lt;</span><span class="mi">80</span><span class="p">;</span><span class="nx">_0x57665f</span><span class="o">++</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">_0x57665f</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span><span class="nx">_0x1520f3</span><span class="p">[</span><span class="nx">_0x57665f</span><span class="p">]</span><span class="o">=</span><span class="nx">_0x433d77</span><span class="p">[</span><span class="nx">_0x52e4f0</span><span class="o">+</span><span class="nx">_0x57665f</span><span class="p">]}</span><span class="k">else</span><span class="p">{</span><span class="nx">_0x1520f3</span><span class="p">[</span><span class="nx">_0x57665f</span><span class="p">]</span><span class="o">=</span><span class="nx">_0x4b3f91</span><span class="p">(</span><span class="nx">_0x1520f3</span><span class="p">[</span><span class="nx">_0x57665f</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">^</span><span class="nx">_0x1520f3</span><span class="p">[</span><span class="nx">_0x57665f</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span><span class="o">^</span><span class="nx">_0x1520f3</span><span class="p">[</span><span class="nx">_0x57665f</span><span class="o">-</span><span class="mi">14</span><span class="p">]</span><span class="o">^</span><span class="nx">_0x1520f3</span><span class="p">[</span><span class="nx">_0x57665f</span><span class="o">-</span><span class="mi">16</span><span class="p">],</span><span class="mi">1</span><span class="p">)}</span><span class="nx">t</span><span class="o">=</span><span class="nx">_0x4f2105</span><span class="p">(</span><span class="nx">_0x4f2105</span><span class="p">(</span><span class="nx">_0x4b3f91</span><span class="p">(</span><span class="nx">_0x236556</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="nx">_0x1a51fe</span><span class="p">(</span><span class="nx">_0x57665f</span><span class="p">,</span><span class="nx">_0x126bca</span><span class="p">,</span><span class="nx">_0x3ca08c</span><span class="p">,</span><span class="nx">_0x1ad745</span><span class="p">)),</span><span class="nx">_0x4f2105</span><span class="p">(</span><span class="nx">_0x4f2105</span><span class="p">(</span><span class="nx">_0x3d4ab1</span><span class="p">,</span><span class="nx">_0x1520f3</span><span class="p">[</span><span class="nx">_0x57665f</span><span class="p">]),</span><span class="nx">_0x5657a6</span><span class="p">(</span><span class="nx">_0x57665f</span><span class="p">)));</span><span class="nx">_0x3d4ab1</span><span class="o">=</span><span class="nx">_0x1ad745</span><span class="p">;</span><span class="nx">_0x1ad745</span><span class="o">=</span><span class="nx">_0x3ca08c</span><span class="p">;</span><span class="nx">_0x3ca08c</span><span class="o">=</span><span class="nx">_0x4b3f91</span><span class="p">(</span><span class="nx">_0x126bca</span><span class="p">,</span><span class="mi">30</span><span class="p">);</span><span class="nx">_0x126bca</span><span class="o">=</span><span class="nx">_0x236556</span><span class="p">;</span><span class="nx">_0x236556</span><span class="o">=</span><span class="nx">t</span><span class="p">}</span><span class="nx">_0x236556</span><span class="o">=</span><span class="nx">_0x4f2105</span><span class="p">(</span><span class="nx">_0x236556</span><span class="p">,</span><span class="nx">_0x5d6482</span><span class="p">);</span><span class="nx">_0x126bca</span><span class="o">=</span><span class="nx">_0x4f2105</span><span class="p">(</span><span class="nx">_0x126bca</span><span class="p">,</span><span class="nx">_0x1bdba3</span><span class="p">);</span><span class="nx">_0x3ca08c</span><span class="o">=</span><span class="nx">_0x4f2105</span><span class="p">(</span><span class="nx">_0x3ca08c</span><span class="p">,</span><span class="nx">_0x256655</span><span class="p">);</span><span class="nx">_0x1ad745</span><span class="o">=</span><span class="nx">_0x4f2105</span><span class="p">(</span><span class="nx">_0x1ad745</span><span class="p">,</span><span class="nx">_0xaf9465</span><span class="p">);</span><span class="nx">_0x3d4ab1</span><span class="o">=</span><span class="nx">_0x4f2105</span><span class="p">(</span><span class="nx">_0x3d4ab1</span><span class="p">,</span><span class="nx">_0x35abf5</span><span class="p">)}</span><span class="k">return</span> <span class="nx">_0x47bf39</span><span class="p">(</span><span class="nx">_0x236556</span><span class="p">)</span><span class="o">+</span><span class="nx">_0x47bf39</span><span class="p">(</span><span class="nx">_0x126bca</span><span class="p">)</span><span class="o">+</span><span class="nx">_0x47bf39</span><span class="p">(</span><span class="nx">_0x3ca08c</span><span class="p">)</span><span class="o">+</span><span class="nx">_0x47bf39</span><span class="p">(</span><span class="nx">_0x1ad745</span><span class="p">)</span><span class="o">+</span><span class="nx">_0x47bf39</span><span class="p">(</span><span class="nx">_0x3d4ab1</span><span class="p">)}</span><span class="kd">function</span> <span class="nx">go</span><span class="p">(</span><span class="nx">_0x184054</span><span class="p">){</span><span class="kd">function</span> <span class="nx">_0x1ec4b0</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">_0x3646eb</span><span class="o">=</span><span class="nb">window</span><span class="p">[</span><span class="s2">&#34;navigator&#34;</span><span class="p">][</span><span class="s2">&#34;userAgent&#34;</span><span class="p">],</span><span class="nx">_0x5e1c0f</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;Phantom&#34;</span><span class="p">];</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">_0x29f991</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">_0x29f991</span><span class="o">&lt;</span><span class="nx">_0x5e1c0f</span><span class="p">[</span><span class="s2">&#34;length&#34;</span><span class="p">];</span><span class="nx">_0x29f991</span><span class="o">++</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">_0x3646eb</span><span class="p">[</span><span class="s2">&#34;indexOf&#34;</span><span class="p">](</span><span class="nx">_0x5e1c0f</span><span class="p">[</span><span class="nx">_0x29f991</span><span class="p">])</span><span class="o">!=-</span><span class="mi">1</span><span class="p">){</span><span class="k">return</span> <span class="kc">true</span><span class="p">}}</span><span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">[</span><span class="s2">&#34;callPhantom&#34;</span><span class="p">]</span><span class="o">||</span><span class="nb">window</span><span class="p">[</span><span class="s2">&#34;_phantom&#34;</span><span class="p">]</span><span class="o">||</span><span class="nb">window</span><span class="p">[</span><span class="s2">&#34;Headless&#34;</span><span class="p">]</span><span class="o">||</span><span class="nb">window</span><span class="p">[</span><span class="s2">&#34;navigator&#34;</span><span class="p">][</span><span class="s2">&#34;webdriver&#34;</span><span class="p">]</span><span class="o">||</span><span class="nb">window</span><span class="p">[</span><span class="s2">&#34;navigator&#34;</span><span class="p">][</span><span class="s2">&#34;__driver_evaluate&#34;</span><span class="p">]</span><span class="o">||</span><span class="nb">window</span><span class="p">[</span><span class="s2">&#34;navigator&#34;</span><span class="p">][</span><span class="s2">&#34;__webdriver_evaluate&#34;</span><span class="p">]){</span><span class="k">return</span> <span class="kc">true</span><span class="p">}}</span><span class="k">if</span><span class="p">(</span><span class="nx">_0x1ec4b0</span><span class="p">()){</span><span class="k">return</span><span class="p">}</span><span class="kd">var</span> <span class="nx">_0x4e5f24</span><span class="o">=</span><span class="k">new</span> <span class="nb">Date</span><span class="p">();</span><span class="kd">function</span> <span class="nx">_0x5e134f</span><span class="p">(</span><span class="nx">_0x36f76f</span><span class="p">,</span><span class="nx">_0x37172a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">_0x2265b3</span><span class="o">=</span><span class="nx">_0x184054</span><span class="p">[</span><span class="s2">&#34;chars&#34;</span><span class="p">][</span><span class="s2">&#34;length&#34;</span><span class="p">];</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">_0x391a5a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">_0x391a5a</span><span class="o">&lt;</span><span class="nx">_0x2265b3</span><span class="p">;</span><span class="nx">_0x391a5a</span><span class="o">++</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">_0x38f12b</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">_0x38f12b</span><span class="o">&lt;</span><span class="nx">_0x2265b3</span><span class="p">;</span><span class="nx">_0x38f12b</span><span class="o">++</span><span class="p">){</span><span class="kd">var</span> <span class="nx">_0x1f3544</span><span class="o">=</span><span class="nx">_0x37172a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="nx">_0x184054</span><span class="p">[</span><span class="s2">&#34;chars&#34;</span><span class="p">][</span><span class="s2">&#34;substr&#34;</span><span class="p">](</span><span class="nx">_0x391a5a</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">_0x184054</span><span class="p">[</span><span class="s2">&#34;chars&#34;</span><span class="p">][</span><span class="s2">&#34;substr&#34;</span><span class="p">](</span><span class="nx">_0x38f12b</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">_0x37172a</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="nx">hash</span><span class="p">(</span><span class="nx">_0x1f3544</span><span class="p">)</span><span class="o">==</span><span class="nx">_0x36f76f</span><span class="p">){</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_0x1f3544</span><span class="p">)</span><span class="k">return</span><span class="p">[</span><span class="nx">_0x1f3544</span><span class="p">,</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span><span class="o">-</span><span class="nx">_0x4e5f24</span><span class="p">]}}}}</span><span class="kd">var</span> <span class="nx">_0x2c759c</span><span class="o">=</span><span class="nx">_0x5e134f</span><span class="p">(</span><span class="nx">_0x184054</span><span class="p">[</span><span class="s2">&#34;ct&#34;</span><span class="p">],</span><span class="nx">_0x184054</span><span class="p">[</span><span class="s2">&#34;bts&#34;</span><span class="p">]);</span><span class="k">if</span><span class="p">(</span><span class="nx">_0x2c759c</span><span class="p">){</span><span class="kd">var</span> <span class="nx">_0x10de0d</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">_0x184054</span><span class="p">[</span><span class="s2">&#34;wt&#34;</span><span class="p">]){</span><span class="nx">_0x10de0d</span><span class="o">=</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x184054</span><span class="p">[</span><span class="s2">&#34;wt&#34;</span><span class="p">])</span><span class="o">&gt;</span><span class="nx">_0x2c759c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">?</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">_0x184054</span><span class="p">[</span><span class="s2">&#34;wt&#34;</span><span class="p">])</span><span class="o">-</span><span class="nx">_0x2c759c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span><span class="mi">500</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="nx">_0x10de0d</span><span class="o">=</span><span class="mi">1500</span><span class="p">}</span><span class="kd">var</span> <span class="nx">_0x158088</span><span class="o">=</span><span class="nx">_0x184054</span><span class="p">[</span><span class="s2">&#34;tn&#34;</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;=&#34;</span><span class="o">+</span><span class="nx">_0x2c759c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;;Max-age=&#34;</span><span class="o">+</span><span class="nx">_0x184054</span><span class="p">[</span><span class="s2">&#34;vt&#34;</span><span class="p">]</span><span class="o">+</span><span class="s2">&#34;; path = /&#34;</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">_0x184054</span><span class="p">[</span><span class="s2">&#34;is&#34;</span><span class="p">]){</span><span class="nx">_0x158088</span><span class="o">=</span><span class="nx">_0x158088</span><span class="o">+</span><span class="s2">&#34;; SameSite=None; Secure&#34;</span><span class="p">}</span><span class="nb">document</span><span class="p">[</span><span class="s2">&#34;cookie&#34;</span><span class="p">]</span><span class="o">=</span><span class="nx">_0x158088</span><span class="p">;</span><span class="nx">location</span><span class="p">[</span><span class="s2">&#34;href&#34;</span><span class="p">]</span><span class="o">=</span><span class="nx">location</span><span class="p">[</span><span class="s2">&#34;pathname&#34;</span><span class="p">]</span><span class="o">+</span><span class="nx">location</span><span class="p">[</span><span class="s2">&#34;search&#34;</span><span class="p">];</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_0x158088</span><span class="p">)</span><span class="k">return</span> <span class="nx">_0x158088</span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&#34;请求验证失败&#34;</span><span class="p">)}}</span><span class="nx">go</span><span class="p">({</span><span class="s2">&#34;bts&#34;</span><span class="o">:</span><span class="p">[</span><span class="s2">&#34;1719472445.601|0|j3A&#34;</span><span class="p">,</span><span class="s2">&#34;LtZQTMBXOgbV%2FXe2COV%2BT0%3D&#34;</span><span class="p">],</span><span class="s2">&#34;chars&#34;</span><span class="o">:</span><span class="s2">&#34;tbXoPOcGKMZFhHtkAwtyWm&#34;</span><span class="p">,</span><span class="s2">&#34;ct&#34;</span><span class="o">:</span><span class="s2">&#34;a87d9a030228c2462949c94a29ac05300528f760&#34;</span><span class="p">,</span><span class="s2">&#34;ha&#34;</span><span class="o">:</span><span class="s2">&#34;sha1&#34;</span><span class="p">,</span><span class="s2">&#34;is&#34;</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span><span class="s2">&#34;tn&#34;</span><span class="o">:</span><span class="s2">&#34;__jsl_clearance_s&#34;</span><span class="p">,</span><span class="s2">&#34;vt&#34;</span><span class="o">:</span><span class="s2">&#34;3600&#34;</span><span class="p">,</span><span class="s2">&#34;wt&#34;</span><span class="o">:</span><span class="s2">&#34;1500&#34;</span><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>setTimeout</code>函数是异步执行的，它不会立即返回值，做一下处理，并让<code>go</code>函数返回<code>cookies</code>。</p>
<blockquote>
<p><code>OB反混淆工具</code>有很多（你们常用哪些，欢迎评论区告诉我，让我<code>涨涨脑子</code>）:</p>
<ul>
<li><code>https://tool.yuanrenxue.cn/decode_obfuscator</code></li>
<li><code>https://de4js.kshift.me/</code>、<code>https://www.dejs.vip/2obfuscator</code></li>
<li>浏览器插件<code>v_tools</code>等</li>
</ul>
</blockquote>
<p>然后，我们迫不及待的运行：</p>
<p><code>node.exe .\final.js</code></p>
<p>回应我们的就是<code>ReferenceError: window is not defined</code>等报错，依次补上：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nb">window</span> <span class="o">=</span> <span class="p">{}</span> <span class="nb">window</span><span class="p">.</span><span class="nx">navigator</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;userAgent&#39;</span><span class="o">:</span><span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36&#39;</span> <span class="p">}</span> <span class="nb">document</span> <span class="o">=</span> <span class="nx">global</span> <span class="nx">location</span> <span class="o">=</span> <span class="p">{}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>再次运行得到：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>haige-py3.10<span class="o">)</span> &gt; node.exe .<span class="se">\f</span>inal.js
</span></span><span class="line"><span class="cl">1719472445.601<span class="p">|</span>0<span class="p">|</span>j3AZtLtZQTMBXOgbV%2FXe2COV%2BT0%3D
</span></span><span class="line"><span class="cl"><span class="nv">__jsl_clearance_s</span><span class="o">=</span>1719472445.601<span class="p">|</span>0<span class="p">|</span>j3AZtLtZQTMBXOgbV%2FXe2COV%2BT0%3D<span class="p">;</span>Max-age<span class="o">=</span>3600<span class="p">;</span> <span class="nv">path</span> <span class="o">=</span> /<span class="p">;</span> <span class="nv">SameSite</span><span class="o">=</span>None<span class="p">;</span> Secure
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>拿去和抓包得到的cookie进行比较，结果一致。</p>
</blockquote>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00001qPkWG1rHzdx.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00001qPkWG1rHzdx.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00001qPkWG1rHzdx.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00001qPkWG1rHzdx.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00001qPkWG1rHzdx.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00001qPkWG1rHzdx.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00001qPkWG1rHzdx.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00001qPkWG1rHzdx.jpg">
    </a></p>
<p>在<code>Pycharm</code>调试时，我们注意到：</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00002JyrsN0yGVqr.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00002JyrsN0yGVqr.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00002JyrsN0yGVqr.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00002JyrsN0yGVqr.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00002JyrsN0yGVqr.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00002JyrsN0yGVqr.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00002JyrsN0yGVqr.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00002JyrsN0yGVqr.jpg">
    </a></p>
<p>我们注意到：条件成立时<code>_0x1f3544</code>为<code>1719472445.601|0|j3AZtLtZQTMBXOgbV%2FXe2COV%2BT0%3D</code>，正好是<code>__jsl_clearance_s</code>的值。</p>
<hr>
<p>尝试着全局搜索参数里的<code>sha1</code>：</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD0000307eR136NyIX.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD0000307eR136NyIX.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD0000307eR136NyIX.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD0000307eR136NyIX.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD0000307eR136NyIX.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD0000307eR136NyIX.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD0000307eR136NyIX.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD0000307eR136NyIX.jpg">
    </a></p>
<p>发现只有参数里带了，所以不难推断：</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD000014YDFA1a7xeM.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD000014YDFA1a7xeM.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD000014YDFA1a7xeM.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD000014YDFA1a7xeM.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD000014YDFA1a7xeM.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD000014YDFA1a7xeM.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD000014YDFA1a7xeM.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD000014YDFA1a7xeM.jpg">
    </a></p>
<p>再找个在线网址验证下<code>sha1</code>也即这里的<code>hash</code>方法是否为魔改过的：</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD000023kcxa2GGrHg.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD000023kcxa2GGrHg.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD000023kcxa2GGrHg.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD000023kcxa2GGrHg.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD000023kcxa2GGrHg.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD000023kcxa2GGrHg.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD000023kcxa2GGrHg.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD000023kcxa2GGrHg.jpg">
    </a></p>
<p>至此，我们其实已经概率性拿到一些数据了（？？）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#! -*-conding=: UTF-8 -*-</span>
</span></span><span class="line"><span class="cl"><span class="c1"># @Author  : 海哥python</span>
</span></span><span class="line"><span class="cl"><span class="c1"># @Software: PyCharm</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">execjs</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">loguru</span> <span class="kn">import</span> <span class="n">logger</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fake_useragent</span> <span class="kn">import</span> <span class="n">UserAgent</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ua</span> <span class="o">=</span> <span class="n">UserAgent</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_first_cookie</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">aa_encode_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;document.cookie=(.*?);location&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">__jsl_clearance_s</span> <span class="o">=</span> <span class="n">execjs</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">aa_encode_text</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;;&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span><span class="p">[</span><span class="s2">&#34;__jsl_clearance_s&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__jsl_clearance_s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;get_first_cookie: </span><span class="si">{</span><span class="n">cookies</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">cookies</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_second_cookie_go_params</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">cookies</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">go_params</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;;go\((.*?)\)&lt;/script&gt;&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">go_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_response_data</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;max&#34;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&#34;offset&#34;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">                           <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s2">&#34;utf-8&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_second_cookies</span><span class="p">(</span><span class="n">cookies</span><span class="p">,</span> <span class="n">go_params</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">__jsl_clearance_s</span> <span class="o">=</span> <span class="n">execjs</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&#34;final.js&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&#34;go&#34;</span><span class="p">,</span> <span class="n">go_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">go_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span><span class="p">[</span><span class="s2">&#34;__jsl_clearance_s&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__jsl_clearance_s</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;cookies: </span><span class="si">{</span><span class="n">cookies</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">cookies</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.xxxx.xxx.cn/flaw/typelist?typeId=27&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">ua</span><span class="o">.</span><span class="n">random</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span> <span class="o">=</span> <span class="n">get_first_cookie</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">go_params</span> <span class="o">=</span> <span class="n">get_second_cookie_go_params</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span> <span class="o">=</span> <span class="n">get_second_cookies</span><span class="p">(</span><span class="n">cookies</span><span class="p">,</span> <span class="n">go_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">go_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">get_response_data</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>然鹅~~并不是每次都能得到我们要的数据！</strong></p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00003NWZZM2MT00J.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00003NWZZM2MT00J.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00003NWZZM2MT00J.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00003NWZZM2MT00J.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00003NWZZM2MT00J.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00003NWZZM2MT00J.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00003NWZZM2MT00J.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00003NWZZM2MT00J.jpg">
    </a></p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00000oz7tL0vfUO2.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00000oz7tL0vfUO2.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00000oz7tL0vfUO2.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00000oz7tL0vfUO2.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00000oz7tL0vfUO2.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00000oz7tL0vfUO2.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00000oz7tL0vfUO2.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00000oz7tL0vfUO2.jpg">
    </a></p>
<blockquote>
<p>通过尝试（抓包），发现加密函数共有<code>sha256</code>、<code>sha1</code>、<code>md5</code>三种情况。</p>
</blockquote>
<p>因此，我们完全可以按照之前的步骤分别得到<code>sha256</code>、<code>sha1</code>、<code>md5</code>三种情况下的<code>js</code>代码，并根据第二次请求时返回的<code>js</code>中的<code>ha</code>调用对应的<code>js</code>得到最终的<code>__jsl_clearance_s</code>。</p>
<blockquote>
<p>又因<code>sha256</code>、<code>sha1</code>、<code>md5</code>的实现并未被魔改，因此完全可以使用<code>Javascript</code>（<code>npm install crypto-js</code>）或<code>python</code>进行简化改写。</p>
</blockquote>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00000JW4ge1uBApB.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00000JW4ge1uBApB.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00000JW4ge1uBApB.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00000JW4ge1uBApB.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00000JW4ge1uBApB.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00000JW4ge1uBApB.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00000JW4ge1uBApB.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00000JW4ge1uBApB.jpg">
    </a></p>
<h2 id="其它调试方式" class="headerLink">
    <a href="#%e5%85%b6%e5%ae%83%e8%b0%83%e8%af%95%e6%96%b9%e5%bc%8f" class="header-mark"></a>其它调试方式</h2><p>其它调试方式还有很多，比较推荐的有：</p>
<h3 id="hook-cookie值使用油猴断一下set-cookie位置" class="headerLink">
    <a href="#hook-cookie%e5%80%bc%e4%bd%bf%e7%94%a8%e6%b2%b9%e7%8c%b4%e6%96%ad%e4%b8%80%e4%b8%8bset-cookie%e4%bd%8d%e7%bd%ae" class="header-mark"></a><code>Hook Cookie</code>值：使用油猴断一下set cookie位置</h3><hr>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="s1">&#39;use strict&#39;</span><span class="p">;</span> <span class="kd">var</span> <span class="nx">org</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">__lookupSetter__</span><span class="p">(</span><span class="s1">&#39;cookie&#39;</span><span class="p">);</span> <span class="nb">document</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;cookie&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">cookie</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;__jsl_clearance_s&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="kr">debugger</span><span class="p">;</span> <span class="p">}</span> <span class="nx">org</span> <span class="o">=</span> <span class="nx">cookie</span><span class="p">;</span> <span class="p">});</span> <span class="nb">document</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;cookie&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">org</span><span class="p">;</span> <span class="p">});</span> <span class="p">})();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00002H04We1otCEl.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00002H04We1otCEl.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00002H04We1otCEl.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00002H04We1otCEl.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00002H04We1otCEl.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00002H04We1otCEl.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00002H04We1otCEl.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00002H04We1otCEl.jpg">
    </a></p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00003mTMq71j363h.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00003mTMq71j363h.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00003mTMq71j363h.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00003mTMq71j363h.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00003mTMq71j363h.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00003mTMq71j363h.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00003mTMq71j363h.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00003mTMq71j363h.jpg">
    </a></p>
<p>清除 cookie 重新刷新页面，页面被成功断住：</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00002NoBjd1DTy9w.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00002NoBjd1DTy9w.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00002NoBjd1DTy9w.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00002NoBjd1DTy9w.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00002NoBjd1DTy9w.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00002NoBjd1DTy9w.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00002NoBjd1DTy9w.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00002NoBjd1DTy9w.jpg">
    </a></p>
<p>然后就可以尝试调试了，这里不做过多介绍。</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00003ngElC1lUMqt.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00003ngElC1lUMqt.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00003ngElC1lUMqt.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00003ngElC1lUMqt.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00003ngElC1lUMqt.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00003ngElC1lUMqt.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00003ngElC1lUMqt.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00003ngElC1lUMqt.jpg">
    </a></p>
<hr>
<h3 id="文件替换利用-fiddler-的自动响应" class="headerLink">
    <a href="#%e6%96%87%e4%bb%b6%e6%9b%bf%e6%8d%a2%e5%88%a9%e7%94%a8-fiddler-%e7%9a%84%e8%87%aa%e5%8a%a8%e5%93%8d%e5%ba%94" class="header-mark"></a>文件替换：利用 Fiddler 的<code>自动响应</code>。</h3><p>将第二次请求获取的<code>js</code>代码保存下来，可以手动复制，也可以向下面这样：</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00001M1d5h2Orjxl.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00001M1d5h2Orjxl.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00001M1d5h2Orjxl.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00001M1d5h2Orjxl.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00001M1d5h2Orjxl.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00001M1d5h2Orjxl.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00001M1d5h2Orjxl.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00001M1d5h2Orjxl.jpg">
    </a></p>
<p>对响应内容进行<code>js</code>美化（<code>https://spidertools.cn/#/formatJS</code>）</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00003XxAnC3DLpkP.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00003XxAnC3DLpkP.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00003XxAnC3DLpkP.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00003XxAnC3DLpkP.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00003XxAnC3DLpkP.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00003XxAnC3DLpkP.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00003XxAnC3DLpkP.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00003XxAnC3DLpkP.jpg">
    </a></p>
<p>清除cookie刷新，也能进行调试了：</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00001toKXM3KoqTY.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00001toKXM3KoqTY.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00001toKXM3KoqTY.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00001toKXM3KoqTY.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00001toKXM3KoqTY.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00001toKXM3KoqTY.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00001toKXM3KoqTY.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00001toKXM3KoqTY.jpg">
    </a></p>
<hr>
<h3 id="文件替换利用-chrome-的文件替换" class="headerLink">
    <a href="#%e6%96%87%e4%bb%b6%e6%9b%bf%e6%8d%a2%e5%88%a9%e7%94%a8-chrome-%e7%9a%84%e6%96%87%e4%bb%b6%e6%9b%bf%e6%8d%a2" class="header-mark"></a>文件替换：利用 Chrome 的文件替换</h3><p>同上，将<code>js</code>代码美化后保存在本地，可能需要一些微调，例如：首尾<code>Script</code>标签前后会多出空格以及脚本最后可能多出<code>/</code>等。补上<code>debuuger;</code>即可进行替换调试：</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD000043rZnD4ScgIS.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD000043rZnD4ScgIS.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD000043rZnD4ScgIS.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD000043rZnD4ScgIS.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD000043rZnD4ScgIS.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD000043rZnD4ScgIS.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD000043rZnD4ScgIS.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD000043rZnD4ScgIS.jpg">
    </a></p>
<p>然后将文件内容替换为上面美化处理后的<code>js</code>代码，清除 cookies 并刷新页面即可调试。</p>
<p><a class="lightgallery" href="https://qqq.gtimg.cn/music/photo_new/T053XD00003nF4tq1MvPjz.jpg" title="https://qqq.gtimg.cn/music/photo_new/T053XD00003nF4tq1MvPjz.jpg" data-thumbnail="https://qqq.gtimg.cn/music/photo_new/T053XD00003nF4tq1MvPjz.jpg">
        <img
            
            loading="lazy"
            src="https://qqq.gtimg.cn/music/photo_new/T053XD00003nF4tq1MvPjz.jpg"
            srcset="https://qqq.gtimg.cn/music/photo_new/T053XD00003nF4tq1MvPjz.jpg, https://qqq.gtimg.cn/music/photo_new/T053XD00003nF4tq1MvPjz.jpg 1.5x, https://qqq.gtimg.cn/music/photo_new/T053XD00003nF4tq1MvPjz.jpg 2x"
            sizes="auto"
            alt="https://qqq.gtimg.cn/music/photo_new/T053XD00003nF4tq1MvPjz.jpg">
    </a></p>
<h2 id="结果验证" class="headerLink">
    <a href="#%e7%bb%93%e6%9e%9c%e9%aa%8c%e8%af%81" class="header-mark"></a>结果验证</h2><p>根据上面的分析，我们拿到了每次请求所需要的<code>cookie</code>，发起请求就是很简单的事了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#! -*-conding=: UTF-8 -*-</span>
</span></span><span class="line"><span class="cl"><span class="c1"># @Author  : 海哥python</span>
</span></span><span class="line"><span class="cl"><span class="c1"># @Software: PyCharm</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">execjs</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">loguru</span> <span class="kn">import</span> <span class="n">logger</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fake_useragent</span> <span class="kn">import</span> <span class="n">UserAgent</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ua</span> <span class="o">=</span> <span class="n">UserAgent</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_first_cookie</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">aa_encode_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;document.cookie=(.*?);location&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">__jsl_clearance_s</span> <span class="o">=</span> <span class="n">execjs</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">aa_encode_text</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;;&#34;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span><span class="p">[</span><span class="s2">&#34;__jsl_clearance_s&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__jsl_clearance_s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;get_first_cookie: </span><span class="si">{</span><span class="n">cookies</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">cookies</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_second_cookie_go_params</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">cookies</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">go_params</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;;go\((.*?)\)&lt;/script&gt;&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">go_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_final_jsl_clearance</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">chars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;chars&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chars</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chars</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">clearance</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;bts&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;chars&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;chars&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;bts&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">encrypt</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ha&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;md5&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">encrypt</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ha&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sha1&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">encrypt</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ha&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sha256&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">encrypt</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">encrypt</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">clearance</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span> <span class="o">=</span> <span class="n">encrypt</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;ct&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">clearance</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_response_data</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;max&#34;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&#34;offset&#34;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s2">&#34;utf-8&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_second_cookies</span><span class="p">(</span><span class="n">cookies</span><span class="p">,</span> <span class="n">go_params</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 方法一：原始js, 这里只有sha1的，所以md5和sha256时会拿不到数据，请按照教程自己分析</span>
</span></span><span class="line"><span class="cl">    <span class="n">__jsl_clearance_s</span> <span class="o">=</span> <span class="n">execjs</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&#34;final.js&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&#34;go&#34;</span><span class="p">,</span> <span class="n">go_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">go_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 方法二： js改写</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># __jsl_clearance_s = execjs.compile(open(&#34;__jsl_clearance_s.js&#34;, &#34;r&#34;, encoding=&#34;utf-8&#34;).read()).call(</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#34;get__jsl_clearance_s&#34;, go_params)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 方法三：python改写</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># __jsl_clearance_s = get_final_jsl_clearance(go_params)  # 通过python脚本获取到jsl_clearance_s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span><span class="p">[</span><span class="s2">&#34;__jsl_clearance_s&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">__jsl_clearance_s</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;cookies: </span><span class="si">{</span><span class="n">cookies</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">cookies</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.xxxx.xxx.cn/flaw/typelist?typeId=27&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="n">ua</span><span class="o">.</span><span class="n">random</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span> <span class="o">=</span> <span class="n">get_first_cookie</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">go_params</span> <span class="o">=</span> <span class="n">get_second_cookie_go_params</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span> <span class="o">=</span> <span class="n">get_second_cookies</span><span class="p">(</span><span class="n">cookies</span><span class="p">,</span> <span class="n">go_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">go_params</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">get_response_data</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="小结" class="headerLink">
    <a href="#%e5%b0%8f%e7%bb%93" class="header-mark"></a>小结</h2><p>遵循文章的指导逆向操作整个解密流程，您会发现这一过程相对简单。关键在于熟练掌握三次请求的顺序及其各自的特征，一旦熟悉这些要点，整个过程将无甚难度。</p>
<h2 id="最后" class="headerLink">
    <a href="#%e6%9c%80%e5%90%8e" class="header-mark"></a>最后</h2><p>如果你觉得文章还不错，请大家<code>点赞、关注、分享、在看</code>下，因为这将是我持续输出更多优质文章的最强动力！</p>
<p>欢迎随时与我联系，我期待与大家交流心得，共同学习，共同进步。</p></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2024-10-06</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/%E5%B0%8F%E7%99%BD%E4%B9%9F%E8%83%BD%E6%87%82%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E6%9F%90%E7%BD%91%E7%AB%99%E5%8A%A0%E9%80%9F%E4%B9%90cookie%E5%8F%82%E6%95%B0%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/index.md target="_blank" rel="noopener noreferrer">阅读原始文档</a>
                    </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/%E5%8A%A0%E9%80%9F%E4%B9%90/">加速乐</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/%E5%B8%B8%E7%94%A8%E7%9A%8438%E7%A7%8D%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E6%B1%87%E6%80%BB/" class="prev" rel="prev" title="常用的38种未授权访问漏洞汇总"><i class="fas fa-angle-left fa-fw"></i>常用的38种未授权访问漏洞汇总</a>
            <a href="/%E5%B7%A5%E5%85%B7/" class="next" rel="next" title="工具集">工具集<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2015 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://www.bysec.cn/" target="_blank" rel="noopener noreferrer">bysec</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                    <span class="icp"><a href="http://beian.miit.gov.cn/" target="_blank">粤ICP备2024294125号</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="回到顶部">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div id="cookieconsent-container"></div><div class="assets"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/katex/copy-tex.min.css">
        <noscript><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"></noscript><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"cookieconsent":{"content":{"dismiss":"同意","link":"了解更多","message":"本网站使用 Cookies 来改善您的浏览体验."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"distance":null,"findAllMatches":null,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":null,"ignoreLocation":null,"isCaseSensitive":null,"location":null,"maxResultLength":10,"minMatchCharLength":null,"noResultsFound":"没有找到结果","snippetLength":50,"threshold":null,"type":"fuse","useExtendedSearch":null},"twemoji":true};</script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/fuse/fuse.min.js"></script><script type="text/javascript" src="/lib/twemoji/twemoji.min.js" defer></script><script type="text/javascript" src="/js/twemoji.min.js" defer></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js" defer></script><script type="text/javascript" src="/lib/katex/auto-render.min.js" defer></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js" defer></script><script type="text/javascript" src="/lib/katex/mhchem.min.js" defer></script><script type="text/javascript" src="/js/katex.min.js" defer></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js" defer></script><script type="text/javascript" src="/js/cookieconsent.min.js" defer></script><script type="text/javascript" src="/js/theme.min.js" defer></script></div>
</body>

</html>